<!DOCTYPE html>
<html lang="en-us" data-darkreader-mode="dynamic" data-darkreader-scheme="dark"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--text" media="screen"></style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble.gtx-bubble, .captcheck_answer_label > input + img, span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"], span[data-href^="https://www.hcaptcha.com/"] > #icon, img.Wirisformula {
    filter: invert(100%) hue-rotate(180deg) contrast(80%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}
[data-darkreader-inline-stopcolor] {
  stop-color: var(--darkreader-inline-stopcolor) !important;
}
[data-darkreader-inline-bg] {
  background: var(--darkreader-inline-bg) !important;
}
[data-darkreader-inline-invert] {
    filter: invert(100%) hue-rotate(180deg);
}</style><style class="darkreader darkreader--variables" media="screen">:root {
   --darkreader-neutral-background: #222425;
   --darkreader-neutral-text: #dedcd9;
   --darkreader-selection-background: #0d52a6;
   --darkreader-selection-text: #dedcd9;
}</style><style class="darkreader darkreader--root-vars" media="screen"></style><style class="darkreader darkreader--user-agent" media="screen">@layer {
html {
    background-color: #222425 !important;
}
html {
    color-scheme: dark !important;
}
iframe {
    color-scheme: dark !important;
}
html, body {
    background-color: #222425;
}
html, body {
    border-color: #746d61;
    color: #dedcd9;
}
a {
    color: #3b8ff2;
}
table {
    border-color: #585f61;
}
mark {
    color: #dedcd9;
}
::placeholder {
    color: #ada79e;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #464a0d !important;
    color: #dedcd9 !important;
}
* {
    scrollbar-color: #4b4f52 #2a2c2d;
}
::selection {
    background-color: #0d52a6 !important;
    color: #dedcd9 !important;
}
::-moz-selection {
    background-color: #0d52a6 !important;
    color: #dedcd9 !important;
}
}</style><meta charset="utf-8"><meta name="author" content="Austin Morlan"><meta property="og:title" content="Building a CHIP-8 Emulator [C++]"><meta property="og:description" content="I’ve always loved emulators because they let me play old games that I enjoyed as a kid, so I thought it might be fun to learn how they work and how to build one. My real goal is to build an NES emulator, but after doing some research, I decided to take the advice of the internet and start by building an emulator for the much less complex CHIP-8 instead. It’s a good stepping stone to the NES."><meta property="og:type" content="article"><meta property="og:url" content="https://austinmorlan.com/posts/chip8_emulator/"><meta property="og:image" content="https://austinmorlan.com/posts/chip8_emulator/media/test_opcode.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-28T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-20T18:57:17-08:00"><title>Building a CHIP-8 Emulator [C++] - Austin Morlan</title><link rel="stylesheet" href="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/style.css"><style class="darkreader darkreader--sync" media="screen"></style><link rel="stylesheet" href="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/syntax.css"><style class="darkreader darkreader--sync" media="screen"></style><link rel="icon" type="image/png" href="https://austinmorlan.com/images/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="https://austinmorlan.com/images/favicon-16x16.png" sizes="16x16"><meta name="generator" content="Hugo 0.124.1"><meta name="darkreader" content="8c9920dfca90450db67022f1a422a459"><style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: #6a500d !important;
    border-color: #9b7e0d !important;
    color: #ceccc7 !important;
}
#vimvixen-console-frame {
    color-scheme: light !important;
}
::placeholder {
    opacity: 0.5 !important;
}
#edge-translate-panel-body,
.MuiTypography-body1,
.nfe-quote-text {
    color: var(--darkreader-neutral-text) !important;
}
gr-main-header {
    background-color: #254e5c !important;
}
.tou-z65h9k,
.tou-mignzq,
.tou-1b6i2ox,
.tou-lnqlqk {
    background-color: var(--darkreader-neutral-background) !important;
}
.tou-75mvi {
    background-color: #1a414d !important;
}
.tou-ta9e87,
.tou-1w3fhi0,
.tou-1b8t2us,
.tou-py7lfi,
.tou-1lpmd9d,
.tou-1frrtv8,
.tou-17ezmgn {
    background-color: #282a2a !important;
}
.tou-uknfeu {
    background-color: #493415 !important;
}
.tou-6i3zyv {
    background-color: #2d6072 !important;
}
div.mermaid-viewer-control-panel .btn {
    background-color: var(--darkreader-neutral-background);
    fill: var(--darkreader-neutral-text);
}
svg g rect.er {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.entityBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxOdd {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxEven {
    fill: var(--darkreader-selection-background);
    fill-opacity: 0.8 !important;
}
svg rect.er.relationshipLabelBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g g.nodes rect,
svg g g.nodes polygon {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.task {
    fill: var(--darkreader-selection-background) !important;
}
svg line.messageLine0,
svg line.messageLine1 {
    stroke: var(--darkreader-neutral-text) !important;
}
div.mermaid .actor {
    fill: var(--darkreader-neutral-background) !important;
}
mitid-authenticators-code-app > .code-app-container {
    background-color: white !important;
    padding-top: 1rem;
}
iframe#unpaywall[src$="unpaywall.html"] {
    color-scheme: light !important;
}
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }</style><link href="data:text/css,%3Ais(%5Bid*%3D'google_ads_iframe'%5D%2C%5Bid*%3D'taboola-'%5D%2C.taboolaHeight%2C.taboola-placeholder%2C%23credential_picker_container%2C%23credentials-picker-container%2C%23credential_picker_iframe%2C%5Bid*%3D'google-one-tap-iframe'%5D%2C%23google-one-tap-popup-container%2C.google-one-tap-modal-div%2C%23amp_floatingAdDiv%2C%23ez-content-blocker-container)%20%7Bdisplay%3Anone!important%3Bmin-height%3A0!important%3Bheight%3A0!important%3B%7D" rel="stylesheet" type="text/css"><style class="darkreader darkreader--cors" media="screen">:is([id*='google_ads_iframe'],[id*='taboola-'],.taboolaHeight,.taboola-placeholder,#credential_picker_container,#credentials-picker-container,#credential_picker_iframe,[id*='google-one-tap-iframe'],#google-one-tap-popup-container,.google-one-tap-modal-div,#amp_floatingAdDiv,#ez-content-blocker-container) {display:none!important;min-height:0!important;height:0!important;}</style><style class="darkreader darkreader--sync" media="screen"></style></head><body><main class="wrapper"><header><div style="font-size:1.5rem;margin-top:1rem;margin-bottom:2rem;display:inline-block;vertical-align:middle"><a href="https://austinmorlan.com/" style="text-decoration:none"><b>AUSTIN MORLAN</b></a><br><hr style="border: 1px solid rgb(255, 255, 255); --darkreader-inline-border-top: #383c3d; --darkreader-inline-border-right: #383c3d; --darkreader-inline-border-bottom: #383c3d; --darkreader-inline-border-left: #383c3d;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><div style="text-align:justify;display:inline-block;width:100%"><a href="https://austinmorlan.com//about" style="text-decoration:none">ABOUT</a>
<a href="mailto:mail@austinmorlan.com" style="text-decoration:none">CONTACT</a>
<a href="https://austinmorlan.com/index.xml" style="text-decoration:none">RSS</a></div></div></header><link rel="stylesheet" href="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/katex.min.css"><style class="darkreader darkreader--cors" media="screen">.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:inline-block;text-align:initial}.katex{font:400 1.21em KaTeX_Main;line-height:1.2;white-space:nowrap;text-indent:0}.katex .katex-html{display:inline-block}.katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.katex .base,.katex .strut{display:inline-block}.katex .mathit{font-family:KaTeX_Math;font-style:italic}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .amsrm,.katex .mathbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr{font-family:KaTeX_Script}.katex .mathsf{font-family:KaTeX_SansSerif}.katex .mainit{font-family:KaTeX_Main;font-style:italic}.katex .textstyle>.mord+.mop{margin-left:.16667em}.katex .textstyle>.mord+.mbin{margin-left:.22222em}.katex .textstyle>.mord+.mrel{margin-left:.27778em}.katex .textstyle>.mop+.mop,.katex .textstyle>.mop+.mord,.katex .textstyle>.mord+.minner{margin-left:.16667em}.katex .textstyle>.mop+.mrel{margin-left:.27778em}.katex .textstyle>.mop+.minner{margin-left:.16667em}.katex .textstyle>.mbin+.minner,.katex .textstyle>.mbin+.mop,.katex .textstyle>.mbin+.mopen,.katex .textstyle>.mbin+.mord{margin-left:.22222em}.katex .textstyle>.mrel+.minner,.katex .textstyle>.mrel+.mop,.katex .textstyle>.mrel+.mopen,.katex .textstyle>.mrel+.mord{margin-left:.27778em}.katex .textstyle>.mclose+.mop{margin-left:.16667em}.katex .textstyle>.mclose+.mbin{margin-left:.22222em}.katex .textstyle>.mclose+.mrel{margin-left:.27778em}.katex .textstyle>.mclose+.minner,.katex .textstyle>.minner+.mop,.katex .textstyle>.minner+.mord,.katex .textstyle>.mpunct+.mclose,.katex .textstyle>.mpunct+.minner,.katex .textstyle>.mpunct+.mop,.katex .textstyle>.mpunct+.mopen,.katex .textstyle>.mpunct+.mord,.katex .textstyle>.mpunct+.mpunct,.katex .textstyle>.mpunct+.mrel{margin-left:.16667em}.katex .textstyle>.minner+.mbin{margin-left:.22222em}.katex .textstyle>.minner+.mrel{margin-left:.27778em}.katex .mclose+.mop,.katex .minner+.mop,.katex .mop+.mop,.katex .mop+.mord,.katex .mord+.mop,.katex .textstyle>.minner+.minner,.katex .textstyle>.minner+.mopen,.katex .textstyle>.minner+.mpunct{margin-left:.16667em}.katex .reset-textstyle.textstyle{font-size:1em}.katex .reset-textstyle.scriptstyle{font-size:.7em}.katex .reset-textstyle.scriptscriptstyle{font-size:.5em}.katex .reset-scriptstyle.textstyle{font-size:1.42857em}.katex .reset-scriptstyle.scriptstyle{font-size:1em}.katex .reset-scriptstyle.scriptscriptstyle{font-size:.71429em}.katex .reset-scriptscriptstyle.textstyle{font-size:2em}.katex .reset-scriptscriptstyle.scriptstyle{font-size:1.4em}.katex .reset-scriptscriptstyle.scriptscriptstyle{font-size:1em}.katex .style-wrap{position:relative}.katex .vlist{display:inline-block}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist .baseline-fix{display:inline-table;table-layout:fixed}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{width:100%}.katex .mfrac .frac-line:before{border-bottom-style:solid;border-bottom-width:1px;content:"";display:block}.katex .mfrac .frac-line:after{border-bottom-style:solid;border-bottom-width:.04em;content:"";display:block;margin-top:-1px}.katex .mspace{display:inline-block}.katex .mspace.negativethinspace{margin-left:-.16667em}.katex .mspace.thinspace{width:.16667em}.katex .mspace.mediumspace{width:.22222em}.katex .mspace.thickspace{width:.27778em}.katex .mspace.enspace{width:.5em}.katex .mspace.quad{width:1em}.katex .mspace.qquad{width:2em}.katex .llap,.katex .rlap{width:0;position:relative}.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .rlap>.inner{left:0}.katex .katex-logo .a{font-size:.75em;margin-left:-.32em;position:relative;top:-.2em}.katex .katex-logo .t{margin-left:-.23em}.katex .katex-logo .e{margin-left:-.1667em;position:relative;top:.2155em}.katex .katex-logo .x{margin-left:-.125em}.katex .rule{display:inline-block;border:0 solid;position:relative}.katex .overline .overline-line,.katex .underline .underline-line{width:100%}.katex .overline .overline-line:before,.katex .underline .underline-line:before{border-bottom-style:solid;border-bottom-width:1px;content:"";display:block}.katex .overline .overline-line:after,.katex .underline .underline-line:after{border-bottom-style:solid;border-bottom-width:.04em;content:"";display:block;margin-top:-1px}.katex .sqrt>.sqrt-sign{position:relative}.katex .sqrt .sqrt-line{width:100%}.katex .sqrt .sqrt-line:before{border-bottom-style:solid;border-bottom-width:1px;content:"";display:block}.katex .sqrt .sqrt-line:after{border-bottom-style:solid;border-bottom-width:.04em;content:"";display:block;margin-top:-1px}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer,.katex .sizing{display:inline-block}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:2em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:3.46em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:4.14em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.98em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.47142857em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.95714286em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.55714286em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.875em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.125em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.25em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.5em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.8em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.1625em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.5875em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:3.1125em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.77777778em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.88888889em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.6em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.92222222em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.3em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.76666667em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.7em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.8em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.9em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.2em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.44em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.73em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:2.07em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.49em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.58333333em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.66666667em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.75em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.83333333em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44166667em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.725em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.075em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.48611111em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.55555556em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.625em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.69444444em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.20138889em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.4375em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72916667em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.28901734em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.40462428em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.46242775em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.52023121em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.57803468em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69364162em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83236994em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.19653179em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.43930636em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.24154589em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.33816425em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.38647343em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.43478261em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.48309179em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.57971014em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69565217em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83574879em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20289855em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.20080321em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.2811245em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.32128514em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.36144578em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.40160643em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48192771em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57831325em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69477912em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.8313253em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist>span,.katex .op-limits>.vlist>span{text-align:center}.katex .accent .accent-body>span{width:0}.katex .accent .accent-body.accent-vec>span{position:relative;left:.326em}.katex .mtable .vertical-separator{display:inline-block;margin:0 -.025em;border-right:.05em solid #000}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist{text-align:center}.katex .mtable .col-align-l>.vlist{text-align:left}.katex .mtable .col-align-r>.vlist{text-align:right}</style><style class="darkreader darkreader--sync" media="screen"></style><script src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/katex.min.js"></script><script src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/auto-render.min.js"></script><noscript><style>.jsonly{display:none}</style></noscript><div class="content">Aug 28, 2019<br><br><h1 class="title">Building a CHIP-8 Emulator [C++]</h1><hr><br><p>I’ve always loved emulators because they let me play old games that I enjoyed as a kid, so I thought it might be fun to
learn how they work and how to build one. My real goal is to build an NES emulator, but after doing some research, I
decided to take the advice of the internet and start by building an emulator for the much less complex
<a href="https://en.wikipedia.org/wiki/CHIP-8">CHIP-8</a> instead. It’s a good stepping stone to the NES.</p><div class="note">Technically the CHIP-8 was never a real machine at all but instead a virtual machine. People would write programs for
this virtual machine, and then an interpreter would decode the instructions. Because it was virtual, the same programs
could run on different machines as long as they had an interpreter. What we're going to create is actually one of those
interpreters, but we'll just consider it an emulator.</div><p>There are a lot of CHIP-8 emulators out there, and a lot of websites about building them, but I noticed a divide between
the two. There might be code without a lot of explanation, or explanations without a lot of code. Those are fine for
an experienced programmer who can fill in the gaps, but I want to provide a holistic reference for the inexperienced.
Not only do I hope to show how to build a simple emulator, but I also hope to teach some low-level computer fundamentals.</p><p>The only requirement is a basic understanding of C++.</p><div class="toc"><nav id="TableOfContents"><ul><li><a href="#how-does-a-cpu-work">How Does a CPU Work?</a></li><li><a href="#what-is-an-emulator">What is an Emulator?</a></li><li><a href="#chip-8-description">CHIP-8 Description</a><ul><li><a href="#16-8-bit-registers">16 8-bit Registers</a></li><li><a href="#4k-bytes-of-memory">4K Bytes of Memory</a></li><li><a href="#16-bit-index-register">16-bit Index Register</a></li><li><a href="#16-bit-program-counter">16-bit Program Counter</a></li><li><a href="#16-level-stack">16-level Stack</a></li><li><a href="#8-bit-stack-pointer">8-bit Stack Pointer</a></li><li><a href="#8-bit-delay-timer">8-bit Delay Timer</a></li><li><a href="#8-bit-sound-timer">8-bit Sound Timer</a></li><li><a href="#16-input-keys">16 Input Keys</a></li><li><a href="#64x32-monochrome-display-memory">64x32 Monochrome Display Memory</a></li><li><a href="#class-members">Class Members</a></li></ul></li><li><a href="#loading-a-rom">Loading a ROM</a></li><li><a href="#loading-the-fonts">Loading the Fonts</a></li><li><a href="#random-number-generator">Random Number Generator</a></li><li><a href="#the-instructions">The Instructions</a></li><li><a href="#function-pointer-table">Function Pointer Table</a></li><li><a href="#fetch-decode-execute">Fetch, Decode, Execute</a></li><li><a href="#the-platform-layer">The Platform Layer</a></li><li><a href="#the-main-loop">The Main Loop</a></li><li><a href="#results">Results</a></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#appendix-bits-bytes-etc">Appendix: Bits, Bytes, Etc.</a><ul><li><a href="#binary">Binary</a></li><li><a href="#hexadecimal">Hexadecimal</a></li><li><a href="#bits-and-bytes">Bits and Bytes</a></li><li><a href="#and-or-not-xor">AND, OR, NOT, XOR</a></li><li><a href="#bitmasking">Bitmasking</a></li><li><a href="#bit-shifting">Bit Shifting</a></li></ul></li><li><a href="#source-code">Source Code</a></li></ul></nav></div><h2 id="how-does-a-cpu-work">How Does a CPU Work?</h2><hr><p>Before we can talk about emulators, we first need a basic understanding of how a CPU works.</p><p>A CPU reads instructions from somewhere in memory that tell it what to do. A CPU may be really fast but it’s stupid.
You have to be very explicit and logical to get it to do what you want and you do that using a discrete set of instructions.</p><p>For example, consider this instruction for the <a href="https://gbdev.io/gb-opcodes/optables/">CPU inside of the original Game
Boy</a>: <strong>$C622</strong>. It encodes an operation and relevant data
into a number that a machine can read.</p><p>Different instructions are encoded in different ways. In this case, the first byte (<strong>$C6</strong>) says <strong>ADD to Register A</strong>,
and the second byte (<strong>$22</strong>) is the value that will be added to Register A. So this instruction says <strong>Add $22 to Register A</strong>.</p><p>As explained above, the CHIP-8 was not a real physical CPU but instead a virtual machine with its
own instruction set, but the same principles apply. For example, consider the CHIP-8 instruction <strong>$7522</strong>. The first byte (<strong>$75</strong>) says
<strong>ADD to Register 5</strong> and the second byte (<strong>$22</strong>) is the value to be added to Register 5. So this
instruction says <strong>ADD $22 to Register 5</strong>.</p><div class="note"><b>$</b> and <b>0x</b> mean that a number is represented in hexadecimal (hex). That is the primary radix used when
dealing with computers at a low-level because it's a much more concise way of presenting large values (like memory
addresses).<br><br>See the Appendix for more info.</div><p>Way back in the day, programmers would write programs in an <strong>assembly language</strong> rather than the high-level languages
(like C++) that we use today. Assembly is as low as you can go while still being human readable. An <strong>assembler</strong> would
translate their human-readable assembly into the 1s and 0s that the computer could understand.</p><p>Keeping with the earlier example, the assembly program would have <strong>ADD V5, $22</strong>, and the assembler would translate
that to <strong>$7522</strong>, which the CHIP-8 interpreter can read. The same thing happens today, only we have
another layer above assembly in the form of high-level languages.</p><h2 id="what-is-an-emulator">What is an Emulator?</h2><hr><p>An emulator reads the original machine code instructions that were assembled for the target machine, interprets them,
and then replicates the functionality of the target machine on the host machine. The ROM files contain the instructions,
the emulator reads those instructions, and then does work to mimic the original machine.</p><p>When an emulator reads the instruction <strong>$7522</strong>, it would emulate the behavior of the CHIP-8 by doing something like
this:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">registers</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+=</span> <span class="mh">0x22</span><span class="p">;</span></span></span></code></pre></td></tr></tbody></table></div></div><p>That’s really all there is to it. When emulating more advanced machines you also have to emulate other components like
the graphics processor and the sound chip. The CHIP-8 is a nice starting project because the CPU only has 34 instructions,
the graphics are simple monochrome pixels, and the sounds are just a single buzzer tone.</p><h2 id="chip-8-description">CHIP-8 Description</h2><hr><p>We’d like to mimic the components of a CHIP-8 in our emulator, so let’s describe them.</p><h3 id="16-8-bit-registers">16 8-bit Registers</h3><p>A register is a dedicated location on a CPU for storage. Any operations that a CPU does must be done within its
registers. A CPU typically only has a few registers, so long-term data is held in memory instead. Operations
often involve loading data from memory into registers, operating on those registers, and then storing the result back
into memory.</p><p>The CHIP-8 has sixteen 8-bit registers, labeled <strong>V0</strong> to <strong>VF</strong>. Each register is able to hold any value from <strong>0x00</strong>
to <strong>0xFF</strong>.</p><p>Register VF is a bit special. It’s used as a flag to hold information about the result of operations.</p><h3 id="4k-bytes-of-memory">4K Bytes of Memory</h3><p>There is relatively little register-space (because it’s expensive), so a computer needs a large chunk of general
memory dedicated to holding program instructions, long-term data, and short-term data. It references different locations
in that memory using an <strong>address</strong>.</p><p>The CHIP-8 has 4096 bytes of memory, meaning the address space is from <strong>0x000</strong> to <strong>0xFFF</strong>.</p><p>The address space is segmented into three sections:</p><ul><li><p><strong>0x000-0x1FF:</strong> Originally reserved for the CHIP-8 interpreter, but in our modern emulator we will just never
write to or read from that area. Except for…</p></li><li><p><strong>0x050-0x0A0:</strong> Storage space for the 16 built-in characters (<strong>0</strong> through <strong>F</strong>), which we will need to manually put into
our memory because ROMs will be looking for those characters.</p></li><li><p><strong>0x200-0xFFF:</strong> Instructions from the ROM will be stored starting at 0x200, and anything left after the ROM’s space
is free to use.</p></li></ul><h3 id="16-bit-index-register">16-bit Index Register</h3><p>The Index Register is a special register used to store memory addresses for use in operations. It’s a 16-bit register
because the maximum memory address (0xFFF) is too big for an 8-bit register.</p><h3 id="16-bit-program-counter">16-bit Program Counter</h3><p>As mentioned earlier, the actual program instructions are stored in memory starting at address <strong>0x200</strong>. The CPU needs
a way of keeping track of which instruction to execute next.</p><p>The Program Counter (PC) is a special register that holds the address of the next instruction to execute. Again, it’s
16 bits because it has to be able to hold the maximum memory address (0xFFF).</p><p>An instruction is two bytes but memory is addressed as a single byte, so when we fetch an instruction from memory we need to
fetch a byte from PC and a byte from PC+1 and connect them into a single value. We then increment the PC by 2 because
We have to increment the PC before we execute any instructions because some instructions will manipulate the PC to control
program flow. Some will add to the PC, some will subtract from it, and some will change it completely.</p><h3 id="16-level-stack">16-level Stack</h3><p>A stack is a way for a CPU to keep track of the order of execution when it calls into functions. There is an instruction
(<strong>CALL</strong>) that will cause the CPU to begin executing instructions in a different region of the program. When the program
reaches another instruction (<strong>RET</strong>), it must be able to go back to where it was when it hit the CALL instruction. The
stack holds the PC value when the CALL instruction was executed, and the RETURN statement pulls that address from the
stack and puts it back into the PC so the CPU will execute it on the next cycle.</p><p>The CHIP-8 has 16 levels of stack, meaning it can hold 16 different PCs. Multiple levels allow for one function to call
another function and so on, until they all return to the original caller site.</p><p>Putting a PC onto the stack is called <strong>pushing</strong> and pulling a PC off of the stack is called <strong>popping</strong>.</p><h3 id="8-bit-stack-pointer">8-bit Stack Pointer</h3><p>Similar to how the PC is used to keep track of where in memory the CPU is executing, we need a Stack Pointer (SP) to tell
us where in the 16-levels of stack our most recent value was placed (i.e, the top).</p><p>We only need 8 bits for our stack pointer because the stack will be represented as an array, so our stack pointer can
just be an index into that array. We only need sixteen indices then, which a single byte can manage.</p><p>When we pop a value off the stack, we won’t actually delete it from the array but instead just copy the value and
decrement the SP so it “points” to the previous value.</p><p>Let’s go through an example of how the stack works. Here is the example program we’re running, with the address of the
instruction on the left and the actual instruction on the right. Don’t worry about the <strong>LD</strong> instructions, just
focus on the __CALL__s and the __RET__s. A <strong>JMP</strong> is like a CALL, but it doesn’t put anything onto the stack.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$200: CALL $208
</span></span><span class="line"><span class="cl">$202: JMP $20E
</span></span><span class="line"><span class="cl">$204: LD V1, $1
</span></span><span class="line"><span class="cl">$206: RET
</span></span><span class="line"><span class="cl">$208: LD V3, $3
</span></span><span class="line"><span class="cl">$20A: CALL $204
</span></span><span class="line"><span class="cl">$20C: RET
</span></span><span class="line"><span class="cl">$20E: LD V4, $4</span></span></code></pre></td></tr></tbody></table></div></div><p>Initially the stack pointer starts at 0, indicating the top of the stack, and the stack itself is just an array
filled with zeroes. As we execute CALLs and RETs, we’ll see what the stack does.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">                   PC: $202          PC: $20A          PC: $20C          PC: $206           PC: $208          PC: $20E         PC: $204          PC: $210
</span></span><span class="line"><span class="cl">                $200: CALL $208   $208: LD V3, $3   $20A: CALL $204   $204: LD V1, $1      $206: RET         $20C: RET        $202: JMP $20E    $20E: JMP
</span></span><span class="line"><span class="cl"> --------          --------          --------          --------          --------          --------          --------          --------          --------
</span></span><span class="line"><span class="cl">|00|0x000| &lt;- SP  |00|0x000| &lt;- SP  |00|0x202|        |00|0x202|        |00|0x202|        |00|0x202|        |00|0x202|        |00|0x202| &lt;- SP  |00|0x202| &lt;- SP
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|01|0x000|        |01|0x000|        |01|0x000| &lt;- SP  |01|0x000| &lt;- SP  |01|0x20C|        |01|0x20C|        |01|0x20C| &lt;- SP  |01|0x20C|        |01|0x20C|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|02|0x000|        |02|0x000|        |02|0x000|        |02|0x000|        |02|0x000| &lt;- SP  |02|0x000| &lt;- SP  |02|0x000|        |02|0x000|        |02|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|03|0x000|        |03|0x000|        |03|0x000|        |03|0x000|        |03|0x000|        |03|0x000|        |03|0x000|        |03|0x000|        |03|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|04|0x000|        |04|0x000|        |04|0x000|        |04|0x000|        |04|0x000|        |04|0x000|        |04|0x000|        |04|0x000|        |04|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|05|0x000|        |05|0x000|        |05|0x000|        |05|0x000|        |05|0x000|        |05|0x000|        |05|0x000|        |05|0x000|        |05|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|06|0x000|        |06|0x000|        |06|0x000|        |06|0x000|        |06|0x000|        |06|0x000|        |06|0x000|        |06|0x000|        |06|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|07|0x000|        |07|0x000|        |07|0x000|        |07|0x000|        |07|0x000|        |07|0x000|        |07|0x000|        |07|0x000|        |07|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|08|0x000|        |08|0x000|        |08|0x000|        |08|0x000|        |08|0x000|        |08|0x000|        |08|0x000|        |08|0x000|        |08|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|09|0x000|        |09|0x000|        |09|0x000|        |09|0x000|        |09|0x000|        |09|0x000|        |09|0x000|        |09|0x000|        |09|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|10|0x000|        |10|0x000|        |10|0x000|        |10|0x000|        |10|0x000|        |10|0x000|        |10|0x000|        |10|0x000|        |10|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|11|0x000|        |11|0x000|        |11|0x000|        |11|0x000|        |11|0x000|        |11|0x000|        |11|0x000|        |11|0x000|        |11|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|12|0x000|        |12|0x000|        |12|0x000|        |12|0x000|        |12|0x000|        |12|0x000|        |12|0x000|        |12|0x000|        |12|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|13|0x000|        |13|0x000|        |13|0x000|        |13|0x000|        |13|0x000|        |13|0x000|        |13|0x000|        |13|0x000|        |13|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|14|0x000|        |14|0x000|        |14|0x000|        |14|0x000|        |14|0x000|        |14|0x000|        |14|0x000|        |14|0x000|        |14|0x000|
</span></span><span class="line"><span class="cl">|--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|        |--------|
</span></span><span class="line"><span class="cl">|15|0x000|        |15|0x000|        |15|0x000|        |15|0x000|        |15|0x000|        |15|0x000|        |15|0x000|        |15|0x000|        |15|0x000|
</span></span><span class="line"><span class="cl"> --------          --------          --------          --------          --------          --------          --------          --------          --------</span></span></code></pre></td></tr></tbody></table></div></div><p>With each CALL, the current PC (which was previously incremented to point to the <em>next</em> instruction) is placed where
the SP was pointing, and the SP is incremented.</p><p>With each RET, the stack pointer is decremented by one and the address that it’s pointing to is put into the PC for execution.</p><p>The actual order of execution looks like this:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$200: CALL $208 -&gt; PC += 2 = $202 | SP = 0 | Put $202 in stack[0] and ++SP = 1    | PC = $208 | Next cycle at PC = $208
</span></span><span class="line"><span class="cl">$208: LD V3, $3 -&gt; PC += 2 = $20A | SP = 1 | Do not modify stack or SP            | PC = $20A | Next cycle at PC = $20A
</span></span><span class="line"><span class="cl">$20A: CALL $204 -&gt; PC += 2 = $20C | SP = 1 | Put $20C on stack[1] and ++SP = 2    | PC = $204 | Next cycle at PC = $204
</span></span><span class="line"><span class="cl">$204: LD V1, $1 -&gt; PC += 2 = $206 | SP = 2 | Do not modify stack or SP            | PC = $206 | Next cycle at PC = $206
</span></span><span class="line"><span class="cl">$206: RET       -&gt; PC += 2 = $208 | SP = 2 | --SP = 1 and Pull $20C from stack[1] | PC = $20C | Next cycle at PC = $20C
</span></span><span class="line"><span class="cl">$20C: RET       -&gt; PC += 2 = $20E | SP = 0 | --SP = 0 and Pull $202 from stack[0] | PC = $202 | Next cycle at PC = $202
</span></span><span class="line"><span class="cl">$202: JMP $20E  -&gt; PC += 2 = $204 | SP = 0 | Do not modify stack or SP            | PC = $204 | Next cycle at PC = $204
</span></span><span class="line"><span class="cl">$20E: LD V4, $4 -&gt; PC += 2 = $210 | SP = 0 | Do not modify stack or SP            | PC = $210 | Next cycle at PC = $210</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="8-bit-delay-timer">8-bit Delay Timer</h3><p>The CHIP-8 has a simple timer used for timing. If the timer value is zero, it stays zero. If it is loaded
with a value, it will decrement at a rate of 60Hz.</p><p>Rather than making sure that the delay timer actually decrements at a rate of 60Hz, I just decrement it at whatever rate
we have the cycle clock set to (discussed later) which has worked fine for all the games I’ve tested.</p><h3 id="8-bit-sound-timer">8-bit Sound Timer</h3><p>The CHIP-8 also has another simple timer used for sound. Its behavior is the same (decrementing at 60Hz if non-zero),
but a single tone will buzz when it’s non-zero. Programmers used this for simple sound emission.</p><p>While I do have a sound timer in my implementation, I opted to not bother with making the application actually emit
any sound. See <a href="https://stackoverflow.com/a/45002609">here</a> for a way to generate a tone with SDL.</p><h3 id="16-input-keys">16 Input Keys</h3><p>The CHIP-8 has 16 input keys that match the first 16 hex values: <strong>0</strong> through <strong>F</strong>. Each key is either pressed or
not pressed.</p><p>I used the input mapping recommended
<a href="http://www.multigesture.net/articles/how-to-write-an-emulator-chip-8-interpreter/">here</a>.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Keypad       Keyboard
</span></span><span class="line"><span class="cl">+-+-+-+-+    +-+-+-+-+
</span></span><span class="line"><span class="cl">|1|2|3|C|    |1|2|3|4|
</span></span><span class="line"><span class="cl">+-+-+-+-+    +-+-+-+-+
</span></span><span class="line"><span class="cl">|4|5|6|D|    |Q|W|E|R|
</span></span><span class="line"><span class="cl">+-+-+-+-+ =&gt; +-+-+-+-+
</span></span><span class="line"><span class="cl">|7|8|9|E|    |A|S|D|F|
</span></span><span class="line"><span class="cl">+-+-+-+-+    +-+-+-+-+
</span></span><span class="line"><span class="cl">|A|0|B|F|    |Z|X|C|V|
</span></span><span class="line"><span class="cl">+-+-+-+-+    +-+-+-+-+</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="64x32-monochrome-display-memory">64x32 Monochrome Display Memory</h3><p>The CHIP-8 has an additional memory buffer used for storing the graphics to display. It is 64 pixels wide and 32
pixels high. Each pixel is either on or off, so only two colors can be represented.</p><p>Understanding and then emulating its operation is probably the most challenging part of the entire project (but still
very easy compared to the NES).</p><p>I’ll cover the exact implementation of the draw instruction down below, but first let’s cover how the drawing works.
As mentioned, a pixel can be either on or off. In our case, we’ll use a <strong>uint32</strong> for each pixel to make it easy to
use with SDL (discussed later), so on is <strong>0xFFFFFFFF</strong> and off is <strong>0x00000000</strong>.</p><p>The draw instruction iterates over each pixel in a sprite and XORs the sprite pixel with the display pixel.</p><ul><li>Sprite Pixel Off XOR Display Pixel Off = Display Pixel Off</li><li>Sprite Pixel Off XOR Display Pixel On = Display Pixel On</li><li>Sprite Pixel On XOR Display Pixel Off = Display Pixel On</li><li>Sprite Pixel On XOR Display Pixel On = Display Pixel Off</li></ul><p>In other words, a display pixel can be set or unset with a sprite. This is often done to only update a specific part
of the screen. If you knew you had drawn a sprite at (X,Y) and you now want to draw it at (X+1,Y+1), you could first
issue a draw command again at (X,Y) which would erase the sprite, and then you could issue another draw command at
(X+1,Y+1) to draw it in the new location. This is why moving objects in CHIP-8 games flicker.</p><p>As an example, let’s pretend we have a blank screen that is 16x10.</p><a href="https://austinmorlan.com/posts/chip8_emulator/media/draw_01.png" target="_blank"><img src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/draw_01.png" alt=""></a><p>We draw a 10x4 sprite at (1,1), so it extends from (1,1) to (10,4).</p><a href="https://austinmorlan.com/posts/chip8_emulator/media/draw_02.png" target="_blank"><img src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/draw_02.png" alt=""></a><p>We then draw an 8x2 sprite at (6,6), so it extends from (6,6) to (13,7).</p><a href="https://austinmorlan.com/posts/chip8_emulator/media/draw_03.png" target="_blank"><img src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/draw_03.png" alt=""></a><p>If we then draw a 3x4 sprite at (7,3), it would cut a piece out of each of them and draw a line in the gap. The overlapping
pixels would turn off (on XOR on = off), and the off pixels would turn on (off XOR on = on).</p><a href="https://austinmorlan.com/posts/chip8_emulator/media/draw_04.png" target="_blank"><img src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/draw_04.png" alt=""></a><p>Some references I’ve read say that a sprite should wrap around to the other side of the screen if attempting to draw
off-screen, so that’s what we’ll do.</p><h3 id="class-members">Class Members</h3><p>Given the aforementioned components, our class data could look like this:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdint&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Chip8</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">registers</span><span class="p">[</span><span class="mi">16</span><span class="p">]{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">memory</span><span class="p">[</span><span class="mi">4096</span><span class="p">]{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">index</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">pc</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">stack</span><span class="p">[</span><span class="mi">16</span><span class="p">]{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">sp</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">delayTimer</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">soundTimer</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">keypad</span><span class="p">[</span><span class="mi">16</span><span class="p">]{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint32_t</span> <span class="n">video</span><span class="p">[</span><span class="mi">64</span> <span class="o">*</span> <span class="mi">32</span><span class="p">]{};</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">opcode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="loading-a-rom">Loading a ROM</h2><hr><p>Before we can execute instructions, we need to have those instructions in memory, so we’ll need a function that loads
the contents of a ROM file.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">START_ADDRESS</span> <span class="o">=</span> <span class="mh">0x200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">LoadROM</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Open the file as a stream of binary and move the file pointer to the end
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span> <span class="o">|</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">ate</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Get size of file and allocate a buffer to hold the contents
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">streampos</span> <span class="n">size</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="n">tellg</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Go back to the beginning of the file and fill the buffer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">file</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">beg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">file</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Load the ROM contents into the Chip8's memory, starting at 0x200
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">memory</span><span class="p">[</span><span class="n">START_ADDRESS</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Free the buffer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">delete</span><span class="p">[]</span> <span class="n">buffer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p>As mentioned earlier, the Chip8’s memory from 0x000 to 0x1FF is reserved, so the ROM instructions must start at 0x200.</p><p>We also want to initially set the PC to 0x200 in the constructor because that will be the first instruction executed.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">Chip8</span><span class="o">::</span><span class="n">Chip8</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Initialize PC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">pc</span> <span class="o">=</span> <span class="n">START_ADDRESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="loading-the-fonts">Loading the Fonts</h2><hr><p>There are sixteen characters that ROMs expected at a certain location so they can write characters to the screen, so
we need to put those characters into memory.</p><p>The characters are examples of <strong>sprites</strong>, which we’ll see more of later. Each character sprite is five bytes.</p><p>The character F, for example, is <strong>0xF0, 0x80, 0xF0, 0x80, 0x80</strong>. Take a look at the binary representation:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">11110000
</span></span><span class="line"><span class="cl">10000000
</span></span><span class="line"><span class="cl">11110000
</span></span><span class="line"><span class="cl">10000000
</span></span><span class="line"><span class="cl">10000000</span></span></code></pre></td></tr></tbody></table></div></div><p>Can you see it? Each bit represents a pixel, where a 1 means the pixel is on and a 0 means the pixel is off.</p><p>We need an array of these bytes to load into memory. There are 16 characters at 5 bytes each, so we need an
array of 80 bytes.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">FONTSET_SIZE</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">uint8_t</span> <span class="n">fontset</span><span class="p">[</span><span class="n">FONTSET_SIZE</span><span class="p">]</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="c1">// 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// 6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="c1">// 7
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// 9
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="c1">// A
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="c1">// B
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// C
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="c1">// D
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="c1">// E
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span>  <span class="c1">// F
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span></span></span></code></pre></td></tr></tbody></table></div></div><p>We can then load them into memory starting at <strong>0x50</strong> in our constructor.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="hl"><span class="lnt"> 1
</span></span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="hl"><span class="lnt"> 7
</span></span><span class="hl"><span class="lnt"> 8
</span></span><span class="hl"><span class="lnt"> 9
</span></span><span class="hl"><span class="lnt">10
</span></span><span class="hl"><span class="lnt">11
</span></span><span class="lnt">12
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line hl"><span class="cl"><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">FONTSET_START_ADDRESS</span> <span class="o">=</span> <span class="mh">0x50</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Chip8</span><span class="o">::</span><span class="n">Chip8</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">[...]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="c1">// Load fonts into memory
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">FONTSET_SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">{</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">memory</span><span class="p">[</span><span class="n">FONTSET_START_ADDRESS</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontset</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="random-number-generator">Random Number Generator</h2><hr><p>There is an instruction which places a random number into a register. With physical hardware this could be achieved by,
reading the value from a noisy disconnected pin or using a dedicated RNG chip, but we’ll just use C++’s built in
random facilities.</p><p>We’ll need to add two member variables and seed the RNG in the constructor. A simple seed is the system clock.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="hl"><span class="lnt"> 1
</span></span><span class="hl"><span class="lnt"> 2
</span></span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="hl"><span class="lnt"> 7
</span></span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="hl"><span class="lnt">13
</span></span><span class="hl"><span class="lnt">14
</span></span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="hl"><span class="lnt">19
</span></span><span class="hl"><span class="lnt">20
</span></span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line hl"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line hl"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="p">[...]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Chip8</span>
</span></span><span class="line hl"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Chip8</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="o">:</span> <span class="n">randGen</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">().</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="p">[...]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="c1">// Initialize RNG
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>		<span class="n">randByte</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">[...]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">default_random_engine</span> <span class="n">randGen</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span> <span class="n">randByte</span><span class="p">;</span></span></span></code></pre></td></tr></tbody></table></div></div><p>We can then get a random number between 0 and 255 by using <strong>randByte</strong>.</p><h2 id="the-instructions">The Instructions</h2><hr><p>The CHIP-8 has 34 instructions that we need to emulate.</p><p>I’ll show the opcode and its description, add any needed helpful info, and show an implementation in code.
The opcode list and descriptions are taken from <a href="http://devernay.free.fr/hacks/chip8/C8TECH10.HTM">here</a>.</p><div class="note">There are differing opinions about how certain instructions should behave. The source I used was the
link just referenced (Cowgod), but there is a second reference <a href="http://mattmik.com/files/chip8/mastering/chip8.html">here</a>
with notable differences in 8xy6, 8xye, Fx55, and Fx65. I implemented both and the games I played worked
the same in both cases, but the test ROMs (discussed later) failed.<br><br>It's likely that the test ROMs were built referencing the same possibly erroneous reference, which is why
they fail when using the actual correct implementation. I'm not going to worry about it, but feel free to
use the second reference instead if you like. Just be aware that the test ROMs used at the end will fail
for you.<br><br>See <a href="https://old.reddit.com/r/programming/comments/3ca4ry/writing_a_chip8_interpreteremulator_in_c14_10/csu7w8k/">here</a>
for more info.</div><p><strong>00E0: CLS</strong></p><p><em>Clear the display.</em></p><p>We can simply set the entire video buffer to zeroes.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_00E0</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">memset</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">video</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>00EE: RET</strong></p><p><em>Return from a subroutine.</em></p><p>The top of the stack has the address of one instruction past the one that called the subroutine, so we can put that
back into the PC. Note that this overwrites our preemptive <strong>pc += 2</strong> earlier.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_00EE</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="o">--</span><span class="n">sp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pc</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">sp</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>1nnn: JP addr</strong></p><p><em>Jump to location nnn.</em></p><p><em>The interpreter sets the program counter to nnn.</em></p><p>A jump doesn’t remember its origin, so no stack interaction required.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_1nnn</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">address</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0FFFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">pc</span> <span class="o">=</span> <span class="n">address</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>2nnn - CALL addr</strong></p><p><em>Call subroutine at nnn.</em></p><p>When we call a subroutine, we want to return eventually, so we put the current PC onto the top of the stack. Remember that
we did <strong>pc += 2</strong> in <strong>Cycle()</strong>, so the current PC holds the next instruction after this CALL, which is correct. We
don’t want to return to the CALL instruction because it would be an infinite loop of CALLs and RETs.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_2nnn</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">address</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0FFFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">stack</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="n">pc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">++</span><span class="n">sp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pc</span> <span class="o">=</span> <span class="n">address</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>3xkk - SE Vx, byte</strong></p><p><em>Skip next instruction if Vx = kk.</em></p><p>Since our PC has already been incremented by 2 in <strong>Cycle()</strong>, we can just increment by 2 again to skip the next
instruction.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_3xkk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">byte</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00FFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">==</span> <span class="n">byte</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>4xkk - SNE Vx, byte</strong></p><p><em>Skip next instruction if Vx != kk.</em></p><p>Since our PC has already been incremented by 2 in <strong>Cycle()</strong>, we can just increment by 2 again to skip the next
instruction.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_4xkk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">byte</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00FFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">byte</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>5xy0 - SE Vx, Vy</strong></p><p><em>Skip next instruction if Vx = Vy.</em></p><p>Since our PC has already been incremented by 2 in <strong>Cycle()</strong>, we can just increment by 2 again to skip the next
instruction.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_5xy0</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">==</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>6xkk - LD Vx, byte</strong></p><p><em>Set Vx = kk.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_6xkk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">byte</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00FFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="n">byte</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>7xkk - ADD Vx, byte</strong></p><p><em>Set Vx = Vx + kk.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_7xkk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">byte</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00FFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">byte</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy0 - LD Vx, Vy</strong></p><p><em>Set Vx = Vy.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy0</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy1 - OR Vx, Vy</strong></p><p><em>Set Vx = Vx OR Vy.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">|=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy2 - AND Vx, Vy</strong></p><p><em>Set Vx = Vx AND Vy.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy3 - XOR Vx, Vy</strong></p><p><em>Set Vx = Vx XOR Vy.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy3</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">^=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy4 - ADD Vx, Vy</strong></p><p><em>Set Vx = Vx + Vy, set VF = carry.</em></p><p><em>The values of Vx and Vy are added together. If the result is greater than 8 bits (i.e., &gt; 255,) VF is set to 1,
otherwise 0. Only the lowest 8 bits of the result are kept, and stored in Vx.</em></p><p>This is an ADD with an overflow flag. If the sum is greater than what can fit into a byte (255), register VF will be
set to 1 as a flag.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy4</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">+</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">sum</span> <span class="o">&gt;</span> <span class="mi">255U</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">&amp;</span> <span class="mh">0xFFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy5 - SUB Vx, Vy</strong></p><p><em>Set Vx = Vx - Vy, set VF = NOT borrow.</em></p><p><em>If Vx &gt; Vy, then VF is set to 1, otherwise 0. Then Vy is subtracted from Vx, and the results stored in Vx.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy5</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">-=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy6 - SHR Vx</strong></p><p><em>Set Vx = Vx SHR 1.</em></p><p><em>If the least-significant bit of Vx is 1, then VF is set to 1, otherwise 0. Then Vx is divided by 2.</em></p><p>A right shift is performed (division by 2), and the least significant bit is saved in Register VF.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy6</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Save LSB in VF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x1u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xy7 - SUBN Vx, Vy</strong></p><p><em>Set Vx = Vy - Vx, set VF = NOT borrow.</em></p><p><em>If Vy &gt; Vx, then VF is set to 1, otherwise 0. Then Vx is subtracted from Vy, and the results stored in Vx.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy7</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">]</span> <span class="o">-</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>8xyE - SHL Vx {, Vy}</strong></p><p><em>Set Vx = Vx SHL 1.</em></p><p><em>If the most-significant bit of Vx is 1, then VF is set to 1, otherwise to 0. Then Vx is multiplied by 2.</em></p><p>A left shift is performed (multiplication by 2), and the most significant bit is saved in Register VF.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xyE</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Save MSB in VF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>9xy0 - SNE Vx, Vy</strong></p><p><em>Skip next instruction if Vx != Vy.</em></p><p>Since our PC has already been incremented by 2 in <strong>Cycle()</strong>, we can just increment by 2 again to skip the next
instruction.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_9xy0</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Annn - LD I, addr</strong></p><p><em>Set I = nnn.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Annn</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">address</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0FFFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">index</span> <span class="o">=</span> <span class="n">address</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Bnnn - JP V0, addr</strong></p><p><em>Jump to location nnn + V0.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Bnnn</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint16_t</span> <span class="n">address</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0FFFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">pc</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">address</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Cxkk - RND Vx, byte</strong></p><p><em>Set Vx = random byte AND kk.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Cxkk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">byte</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00FFu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="n">randByte</span><span class="p">(</span><span class="n">randGen</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">byte</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Dxyn - DRW Vx, Vy, nibble</strong></p><p><em>Display n-byte sprite starting at memory location I at (Vx, Vy), set VF = collision.</em></p><p>We iterate over the sprite, row by row and column by column. We know there are eight columns because a sprite is
guaranteed to be eight pixels wide.</p><p>If a sprite pixel is on then there may be a collision with what’s already being displayed, so we check if our screen
pixel in the same location is set. If so we must set the VF register to express collision.</p><p>Then we can just XOR the screen pixel with 0xFFFFFFFF to essentially XOR it with the sprite pixel (which we now know is
on). We can’t XOR directly because the sprite pixel is either 1 or 0 while our video pixel is either 0x00000000 or
0xFFFFFFFF.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Dxyn</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vy</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00F0u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">height</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x000Fu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Wrap if going beyond screen boundaries
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">uint8_t</span> <span class="n">xPos</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">%</span> <span class="n">VIDEO_WIDTH</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">yPos</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vy</span><span class="p">]</span> <span class="o">%</span> <span class="n">VIDEO_HEIGHT</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">height</span><span class="p">;</span> <span class="o">++</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">uint8_t</span> <span class="n">spriteByte</span> <span class="o">=</span> <span class="n">memory</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">row</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="o">++</span><span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="kt">uint8_t</span> <span class="n">spritePixel</span> <span class="o">=</span> <span class="n">spriteByte</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x80u</span> <span class="o">&gt;&gt;</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="kt">uint32_t</span><span class="o">*</span> <span class="n">screenPixel</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">video</span><span class="p">[(</span><span class="n">yPos</span> <span class="o">+</span> <span class="n">row</span><span class="p">)</span> <span class="o">*</span> <span class="n">VIDEO_WIDTH</span> <span class="o">+</span> <span class="p">(</span><span class="n">xPos</span> <span class="o">+</span> <span class="n">col</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Sprite pixel is on
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">spritePixel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Screen pixel also on - collision
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">screenPixel</span> <span class="o">==</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">registers</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// Effectively XOR with the sprite pixel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="o">*</span><span class="n">screenPixel</span> <span class="o">^=</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Ex9E - SKP Vx</strong></p><p><em>Skip next instruction if key with the value of Vx is pressed.</em></p><p>Since our PC has already been incremented by 2 in <strong>Cycle()</strong>, we can just increment by 2 again to skip the next
instruction.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Ex9E</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">key</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>ExA1 - SKNP Vx</strong></p><p><em>Skip next instruction if key with the value of Vx is not pressed.</em></p><p>Since our PC has already been incremented by 2 in <strong>Cycle()</strong>, we can just increment by 2 again to skip the next
instruction.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_ExA1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">key</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">keypad</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx07 - LD Vx, DT</strong></p><p><em>Set Vx = delay timer value.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx07</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="n">delayTimer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx0A - LD Vx, K</strong></p><p><em>Wait for a key press, store the value of the key in Vx.</em></p><p>The easiest way to “wait” is to decrement the PC by 2 whenever a keypad value is not detected. This has the effect of
running the same instruction repeatedly.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx0A</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">keypad</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">pc</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx15 - LD DT, Vx</strong></p><p><em>Set delay timer = Vx.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx15</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">delayTimer</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx18 - LD ST, Vx</strong></p><p><em>Set sound timer = Vx.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx18</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">soundTimer</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx1E - ADD I, Vx</strong></p><p><em>Set I = I + Vx.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx1E</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">index</span> <span class="o">+=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx29 - LD F, Vx</strong></p><p><em>Set I = location of sprite for digit Vx.</em></p><p>We know the font characters are located at 0x50, and we know they’re five bytes each, so we can get the address of the
first byte of any character by taking an offset from the start address.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx29</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">digit</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">index</span> <span class="o">=</span> <span class="n">FONTSET_START_ADDRESS</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">digit</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx33 - LD B, Vx</strong></p><p><em>Store BCD representation of Vx in memory locations I, I+1, and I+2.</em></p><p><em>The interpreter takes the decimal value of Vx, and places the hundreds digit in memory at location in I,
the tens digit at location I+1, and the ones digit at location I+2.</em></p><p>We can use the modulus operator to get the right-most digit of a number, and then do a division to remove that
digit. A division by ten will either completely remove the digit (340 / 10 = 34), or result in a float which will
be truncated (345 / 10 = 34.5 = 34).</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx33</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">value</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">Vx</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Ones-place
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">memory</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">value</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Tens-place
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">memory</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">value</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Hundreds-place
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">memory</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx55 - LD [I], Vx</strong></p><p><em>Store registers V0 through Vx in memory starting at location I.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx55</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">Vx</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">memory</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">registers</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><p><strong>Fx65 - LD Vx, [I]</strong></p><p><em>Read registers V0 through Vx from memory starting at location I.</em></p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx65</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint8_t</span> <span class="n">Vx</span> <span class="o">=</span> <span class="p">(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x0F00u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">Vx</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">registers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">memory</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="function-pointer-table">Function Pointer Table</h2><hr><p>The easiest way to decode an opcode is with a switch statement, but it gets messy when you have a lot of instructions.
The CHIP-8 isn’t so bad, but we’ll use a different technique that is more scalable and good to know when making more
advanced emulators.</p><p>Instead we’ll implement an array of function pointers where the opcode is an index into an array of function pointers.
The downside to a function pointer table is that we must have an array big enough to account for every opcode because the
opcode is an index into the array. Dereferencing a pointer for every instruction may also have problems, but when
your emulator is complex it’s probably worth it.</p><p>If you look at the list of opcodes, you’ll notice that there are four types:</p><ul><li>The entire opcode is unique:<ul><li>$1nnn</li><li>$2nnn</li><li>$3xkk</li><li>$4xkk</li><li>$5xy0</li><li>$6xkk</li><li>$7xkk</li><li>$9xy0</li><li>$Annn</li><li>$Bnnn</li><li>$Cxkk</li><li>$Dxyn</li></ul></li><li>The first digit repeats but the last digit is unique:<ul><li>$8xy0</li><li>$8xy1</li><li>$8xy2</li><li>$8xy3</li><li>$8xy4</li><li>$8xy5</li><li>$8xy6</li><li>$8xy7</li><li>$8xyE</li></ul></li><li>The first three digits are $00E but the fourth digit is unique:<ul><li>$00E0</li><li>$00EE</li></ul></li><li>The first digit repeats but the last two digits are unique:<ul><li>$ExA1</li><li>$Ex9E</li><li>$Fx07</li><li>$Fx0A</li><li>$Fx15</li><li>$Fx18</li><li>$Fx1E</li><li>$Fx29</li><li>$Fx33</li><li>$Fx55</li><li>$Fx65</li></ul></li></ul><p>The first digits go from $0 to $F so we’ll need an array of function pointers that can be indexed up to $F, which requires
$F + 1 elements.</p><p>For the opcodes with first digits that repeat ($0, $8, $E, $F), we’ll need secondary tables that can accommodate each
of those.</p><ul><li>$0 needs an array that can index up to $E+1</li><li>$8 needs an array that can index up to $E+1</li><li>$E needs an array that can index up to $E+1</li><li>$F needs an array that can index up to $65+1</li></ul><p>In the master <strong>table</strong>, we set up a function pointer to a function that then indexes correctly based on the relevant
parts of the opcode.</p><p>Just in case one of the invalid opcodes is called, we can create a dummy <strong>OP_NULL</strong> function that does nothing, but
will be the default function called if a proper function pointer is not set.</p><div class="note">C++ member function pointer syntax is horrendous.</div><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="hl"><span class="lnt"> 8
</span></span><span class="hl"><span class="lnt"> 9
</span></span><span class="hl"><span class="lnt">10
</span></span><span class="hl"><span class="lnt">11
</span></span><span class="hl"><span class="lnt">12
</span></span><span class="hl"><span class="lnt">13
</span></span><span class="hl"><span class="lnt">14
</span></span><span class="hl"><span class="lnt">15
</span></span><span class="hl"><span class="lnt">16
</span></span><span class="hl"><span class="lnt">17
</span></span><span class="hl"><span class="lnt">18
</span></span><span class="hl"><span class="lnt">19
</span></span><span class="hl"><span class="lnt">20
</span></span><span class="hl"><span class="lnt">21
</span></span><span class="hl"><span class="lnt">22
</span></span><span class="hl"><span class="lnt">23
</span></span><span class="hl"><span class="lnt">24
</span></span><span class="hl"><span class="lnt">25
</span></span><span class="hl"><span class="lnt">26
</span></span><span class="hl"><span class="lnt">27
</span></span><span class="hl"><span class="lnt">28
</span></span><span class="hl"><span class="lnt">29
</span></span><span class="hl"><span class="lnt">30
</span></span><span class="hl"><span class="lnt">31
</span></span><span class="hl"><span class="lnt">32
</span></span><span class="hl"><span class="lnt">33
</span></span><span class="hl"><span class="lnt">34
</span></span><span class="hl"><span class="lnt">35
</span></span><span class="hl"><span class="lnt">36
</span></span><span class="hl"><span class="lnt">37
</span></span><span class="hl"><span class="lnt">38
</span></span><span class="hl"><span class="lnt">39
</span></span><span class="hl"><span class="lnt">40
</span></span><span class="hl"><span class="lnt">41
</span></span><span class="hl"><span class="lnt">42
</span></span><span class="hl"><span class="lnt">43
</span></span><span class="hl"><span class="lnt">44
</span></span><span class="hl"><span class="lnt">45
</span></span><span class="hl"><span class="lnt">46
</span></span><span class="hl"><span class="lnt">47
</span></span><span class="hl"><span class="lnt">48
</span></span><span class="hl"><span class="lnt">49
</span></span><span class="hl"><span class="lnt">50
</span></span><span class="hl"><span class="lnt">51
</span></span><span class="hl"><span class="lnt">52
</span></span><span class="hl"><span class="lnt">53
</span></span><span class="hl"><span class="lnt">54
</span></span><span class="hl"><span class="lnt">55
</span></span><span class="hl"><span class="lnt">56
</span></span><span class="hl"><span class="lnt">57
</span></span><span class="hl"><span class="lnt">58
</span></span><span class="hl"><span class="lnt">59
</span></span><span class="hl"><span class="lnt">60
</span></span><span class="hl"><span class="lnt">61
</span></span><span class="hl"><span class="lnt">62
</span></span><span class="hl"><span class="lnt">63
</span></span><span class="hl"><span class="lnt">64
</span></span><span class="hl"><span class="lnt">65
</span></span><span class="hl"><span class="lnt">66
</span></span><span class="hl"><span class="lnt">67
</span></span><span class="hl"><span class="lnt">68
</span></span><span class="hl"><span class="lnt">69
</span></span><span class="hl"><span class="lnt">70
</span></span><span class="hl"><span class="lnt">71
</span></span><span class="hl"><span class="lnt">72
</span></span><span class="hl"><span class="lnt">73
</span></span><span class="hl"><span class="lnt">74
</span></span><span class="hl"><span class="lnt">75
</span></span><span class="hl"><span class="lnt">76
</span></span><span class="hl"><span class="lnt">77
</span></span><span class="hl"><span class="lnt">78
</span></span><span class="hl"><span class="lnt">79
</span></span><span class="hl"><span class="lnt">80
</span></span><span class="hl"><span class="lnt">81
</span></span><span class="hl"><span class="lnt">82
</span></span><span class="hl"><span class="lnt">83
</span></span><span class="hl"><span class="lnt">84
</span></span><span class="hl"><span class="lnt">85
</span></span><span class="hl"><span class="lnt">86
</span></span><span class="hl"><span class="lnt">87
</span></span><span class="hl"><span class="lnt">88
</span></span><span class="hl"><span class="lnt">89
</span></span><span class="hl"><span class="lnt">90
</span></span><span class="hl"><span class="lnt">91
</span></span><span class="hl"><span class="lnt">92
</span></span><span class="hl"><span class="lnt">93
</span></span><span class="hl"><span class="lnt">94
</span></span><span class="hl"><span class="lnt">95
</span></span><span class="hl"><span class="lnt">96
</span></span><span class="lnt">97
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Chip8</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Chip8</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="o">:</span> <span class="n">randGen</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">().</span><span class="n">time_since_epoch</span><span class="p">().</span><span class="n">count</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="p">[...]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="c1">// Set up function pointer table
</span></span></span><span class="line hl"><span class="cl"><span class="c1"></span>		<span class="n">table</span><span class="p">[</span><span class="mh">0x0</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">Table0</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x1</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_1nnn</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x2</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_2nnn</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x3</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_3xkk</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x4</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_4xkk</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x5</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_5xy0</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x6</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_6xkk</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x7</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_7xkk</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x8</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">Table8</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0x9</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_9xy0</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0xA</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Annn</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0xB</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Bnnn</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0xC</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Cxkk</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0xD</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Dxyn</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0xE</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">TableE</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">TableF</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">{</span>
</span></span><span class="line hl"><span class="cl">			<span class="n">table0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_NULL</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">			<span class="n">table8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_NULL</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">			<span class="n">tableE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_NULL</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="n">table0</span><span class="p">[</span><span class="mh">0x0</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_00E0</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table0</span><span class="p">[</span><span class="mh">0xE</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_00EE</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x0</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy0</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x1</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy1</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x2</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy2</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x3</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy3</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x4</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy4</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x5</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy5</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x6</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy6</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0x7</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xy7</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">table8</span><span class="p">[</span><span class="mh">0xE</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_8xyE</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="n">tableE</span><span class="p">[</span><span class="mh">0x1</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_ExA1</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableE</span><span class="p">[</span><span class="mh">0xE</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Ex9E</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x65</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">{</span>
</span></span><span class="line hl"><span class="cl">			<span class="n">tableF</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_NULL</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x07</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx07</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x0A</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx0A</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x15</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx15</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x18</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx18</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x1E</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx1E</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x29</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx29</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x33</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx33</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x55</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx55</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">		<span class="n">tableF</span><span class="p">[</span><span class="mh">0x65</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Chip8</span><span class="o">::</span><span class="n">OP_Fx65</span><span class="p">;</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="kt">void</span> <span class="nf">Table0</span><span class="p">()</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">{</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="o">*</span><span class="p">(</span><span class="n">table0</span><span class="p">[</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x000Fu</span><span class="p">]))();</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="kt">void</span> <span class="nf">Table8</span><span class="p">()</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">{</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="o">*</span><span class="p">(</span><span class="n">table8</span><span class="p">[</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x000Fu</span><span class="p">]))();</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="kt">void</span> <span class="nf">TableE</span><span class="p">()</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">{</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="o">*</span><span class="p">(</span><span class="n">tableE</span><span class="p">[</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x000Fu</span><span class="p">]))();</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="kt">void</span> <span class="nf">TableF</span><span class="p">()</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">{</span>
</span></span><span class="line hl"><span class="cl">		<span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="o">*</span><span class="p">(</span><span class="n">tableF</span><span class="p">[</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0x00FFu</span><span class="p">]))();</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="kt">void</span> <span class="nf">OP_NULL</span><span class="p">()</span>
</span></span><span class="line hl"><span class="cl">	<span class="p">{}</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="p">[...]</span>
</span></span><span class="line hl"><span class="cl">
</span></span><span class="line hl"><span class="cl">	<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="n">Chip8</span><span class="o">::*</span><span class="n">Chip8Func</span><span class="p">)();</span>
</span></span><span class="line hl"><span class="cl">	<span class="n">Chip8Func</span> <span class="n">table</span><span class="p">[</span><span class="mh">0xF</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line hl"><span class="cl">	<span class="n">Chip8Func</span> <span class="n">table0</span><span class="p">[</span><span class="mh">0xE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line hl"><span class="cl">	<span class="n">Chip8Func</span> <span class="n">table8</span><span class="p">[</span><span class="mh">0xE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line hl"><span class="cl">	<span class="n">Chip8Func</span> <span class="n">tableE</span><span class="p">[</span><span class="mh">0xE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line hl"><span class="cl">	<span class="n">Chip8Func</span> <span class="n">tableF</span><span class="p">[</span><span class="mh">0x65</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="fetch-decode-execute">Fetch, Decode, Execute</h2><hr><p>When we talk about one cycle of this primitive CPU that we’re emulating, we’re talking about it doing three things:</p><ul><li>Fetch the next instruction in the form of an opcode</li><li>Decode the instruction to determine what operation needs to occur</li><li>Execute the instruction</li></ul><p>The decoding and executing are done with the function pointers we just implemented. We get the first digit of the opcode
with a bitmask, shift it over so that it becomes a single digit from $0 to $F, and use that as index into the function
pointer array. It’s then further decoded in the <strong>Table()</strong> method.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Chip8</span><span class="o">::</span><span class="n">Cycle</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Fetch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">memory</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8u</span><span class="p">)</span> <span class="o">|</span> <span class="n">memory</span><span class="p">[</span><span class="n">pc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Increment the PC before we execute anything
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Decode and Execute
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">((</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="o">*</span><span class="p">(</span><span class="n">table</span><span class="p">[(</span><span class="n">opcode</span> <span class="o">&amp;</span> <span class="mh">0xF000u</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12u</span><span class="p">]))();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Decrement the delay timer if it's been set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">delayTimer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="o">--</span><span class="n">delayTimer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Decrement the sound timer if it's been set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">soundTimer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="o">--</span><span class="n">soundTimer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="the-platform-layer">The Platform Layer</h2><hr><p>We’ll use SDL to render and get input in a multi-platform way. Using an <strong>SDL_Renderer</strong> gives us 2D GPU acceleration,
and an <strong>SDL_Texture</strong> is an easy way to render a 2D image. Consult the
<a href="https://wiki.libsdl.org/APIByCategory">SDL documentation</a> for more specific information.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Platform</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Platform</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">title</span><span class="p">,</span> <span class="kt">int</span> <span class="n">windowWidth</span><span class="p">,</span> <span class="kt">int</span> <span class="n">windowHeight</span><span class="p">,</span> <span class="kt">int</span> <span class="n">textureWidth</span><span class="p">,</span> <span class="kt">int</span> <span class="n">textureHeight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_Init</span><span class="p">(</span><span class="n">SDL_INIT_VIDEO</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">window</span> <span class="o">=</span> <span class="n">SDL_CreateWindow</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">windowWidth</span><span class="p">,</span> <span class="n">windowHeight</span><span class="p">,</span> <span class="n">SDL_WINDOW_SHOWN</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">renderer</span> <span class="o">=</span> <span class="n">SDL_CreateRenderer</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">SDL_RENDERER_ACCELERATED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">texture</span> <span class="o">=</span> <span class="n">SDL_CreateTexture</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">renderer</span><span class="p">,</span> <span class="n">SDL_PIXELFORMAT_RGBA8888</span><span class="p">,</span> <span class="n">SDL_TEXTUREACCESS_STREAMING</span><span class="p">,</span> <span class="n">textureWidth</span><span class="p">,</span> <span class="n">textureHeight</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">Platform</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_DestroyTexture</span><span class="p">(</span><span class="n">texture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_DestroyRenderer</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_DestroyWindow</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_Quit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">void</span> <span class="k">const</span><span class="o">*</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pitch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_UpdateTexture</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">pitch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_RenderClear</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_RenderCopy</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">texture</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">SDL_RenderPresent</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="nf">ProcessInput</span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span> <span class="n">keys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">bool</span> <span class="n">quit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">SDL_Event</span> <span class="n">event</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">SDL_PollEvent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">case</span> <span class="nl">SDL_QUIT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="k">case</span> <span class="nl">SDL_KEYDOWN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">key</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">sym</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_ESCAPE</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">quit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_x</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_q</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_w</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_a</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_d</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_z</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xA</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_c</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xB</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xC</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_r</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xD</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xE</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_v</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="k">case</span> <span class="nl">SDL_KEYUP</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">key</span><span class="p">.</span><span class="n">keysym</span><span class="p">.</span><span class="n">sym</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="p">{</span>
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_x</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_q</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_w</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_a</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_d</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_z</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xA</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_c</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xB</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xC</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_r</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xD</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xE</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">						<span class="k">case</span> <span class="nl">SDLK_v</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">						<span class="p">{</span>
</span></span><span class="line"><span class="cl">							<span class="n">keys</span><span class="p">[</span><span class="mh">0xF</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">						<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="p">}</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">quit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">SDL_Window</span><span class="o">*</span> <span class="n">window</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="n">SDL_Renderer</span><span class="o">*</span> <span class="n">renderer</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">	<span class="n">SDL_Texture</span><span class="o">*</span> <span class="n">texture</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="the-main-loop">The Main Loop</h2><hr><p>Finally we need our main loop that will call our <strong>Chip8::Cycle()</strong> function continuously until exit, handle input,
and render with SDL.</p><p>We’ll use three command-line arguments:</p><ul><li><strong>Scale:</strong> The CHIP-8 video buffer is only 64x32, so we’ll need an integer scale factor to be able to play on our
big modern monitors.</li><li><strong>Delay:</strong> The CHIP-8 had no specified clock speed, so we’ll use a delay to determine the time in milliseconds between
cycles. Different games run best at different speeds, so we can control it here.</li><li><strong>ROM:</strong> The ROM file to load.</li></ul><p>With each iteration of the loop: input from the keyboard is parsed, a delay is checked to see if enough time has passed
between cycles and a cycle is run if so, and the screen is updated.</p><p>Due to the way SDL works, we can simply pass in the <strong>video</strong> parameter to SDL and it will scale it automatically
for us to the size of our window texture.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char__</span> <span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Usage: "</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" &lt;Scale&gt; &lt;Delay&gt; &lt;ROM&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">videoScale</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">cycleDelay</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">romFilename</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Platform</span> <span class="n">platform</span><span class="p">(</span><span class="s">"CHIP-8 Emulator"</span><span class="p">,</span> <span class="n">VIDEO_WIDTH</span> <span class="o">*</span> <span class="n">videoScale</span><span class="p">,</span> <span class="n">VIDEO_HEIGHT</span> <span class="o">*</span> <span class="n">videoScale</span><span class="p">,</span> <span class="n">VIDEO_WIDTH</span><span class="p">,</span> <span class="n">VIDEO_HEIGHT</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Chip8</span> <span class="n">chip8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">chip8</span><span class="p">.</span><span class="n">LoadROM</span><span class="p">(</span><span class="n">romFilename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">videoPitch</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">chip8</span><span class="p">.</span><span class="n">video</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">VIDEO_WIDTH</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">auto</span> <span class="n">lastCycleTime</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">quit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">quit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">quit</span> <span class="o">=</span> <span class="n">platform</span><span class="p">.</span><span class="n">ProcessInput</span><span class="p">(</span><span class="n">chip8</span><span class="p">.</span><span class="n">keypad</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">auto</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">::</span><span class="n">period</span><span class="o">&gt;</span><span class="p">(</span><span class="n">currentTime</span> <span class="o">-</span> <span class="n">lastCycleTime</span><span class="p">).</span><span class="n">count</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">dt</span> <span class="o">&gt;</span> <span class="n">cycleDelay</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">lastCycleTime</span> <span class="o">=</span> <span class="n">currentTime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">chip8</span><span class="p">.</span><span class="n">Cycle</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">platform</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">chip8</span><span class="p">.</span><span class="n">video</span><span class="p">,</span> <span class="n">videoPitch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></tbody></table></div></div><h2 id="results">Results</h2><hr><p>We can use <a href="https://github.com/corax89/chip8-test-rom">this test ROM</a> to ensure that our CPU is
operating like we expect.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">./chip8 10 1 test_opcode.ch8</span></span></code></pre></td></tr></tbody></table></div></div><a href="https://austinmorlan.com/posts/chip8_emulator/media/test_opcode.png" target="_blank"><img src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/test_opcode.png" alt=""></a><p>Let’s also test our input by playing a game:
<a href="https://github.com/dmatlack/chip8/tree/master/roms/games">Tetris</a>. I’ve found a delay of 3 or 4 is
pretty good.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">./chip8 10 3 Tetris.ch8</span></span></code></pre></td></tr></tbody></table></div></div><video controls="controls" preload="metadata">
<source src="Building%20a%20CHIP-8%20Emulator%20[C++]%20-%20Austin%20Morlan_files/tetris.mp4" type="video/mp4"></video><h2 id="conclusion">Conclusion</h2><hr><p>Congratulations! We’ve successfully built a very simple emulator. Hopefully you’ve learned something about emulators,
bit-twiddling, logic, CPU operations, and more. Take that knowledge and put it to use in other programming endeavors,
or move onto building an NES emulator. That’s what I’ll be doing.</p><h2 id="appendix-bits-bytes-etc">Appendix: Bits, Bytes, Etc.</h2><hr><p>Low-level bit manipulation is a very important part of this project, so if you need a primer or refresher, here it is.</p><h3 id="binary">Binary</h3><p>Computers operate on numbers in the form of <strong>binary</strong>, which is <strong>base-2</strong>. Any number can be presented in binary.
There is a pattern to binary that helps with understanding it. Here is the sequence from 0 to 15:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">|3|2|1|0|
</span></span><span class="line"><span class="cl">|-|-|-|-|
</span></span><span class="line"><span class="cl">|0|0|0|0|
</span></span><span class="line"><span class="cl">|0|0|0|1|
</span></span><span class="line"><span class="cl">|0|0|1|0|
</span></span><span class="line"><span class="cl">|0|0|1|1|
</span></span><span class="line"><span class="cl">|0|1|0|0|
</span></span><span class="line"><span class="cl">|0|1|0|1|
</span></span><span class="line"><span class="cl">|0|1|1|0|
</span></span><span class="line"><span class="cl">|0|1|1|1|
</span></span><span class="line"><span class="cl">|1|0|0|0|
</span></span><span class="line"><span class="cl">|1|0|0|1|
</span></span><span class="line"><span class="cl">|1|0|1|0|
</span></span><span class="line"><span class="cl">|1|0|1|1|
</span></span><span class="line"><span class="cl">|1|1|0|0|
</span></span><span class="line"><span class="cl">|1|1|0|1|
</span></span><span class="line"><span class="cl">|1|1|1|0|
</span></span><span class="line"><span class="cl">|1|1|1|1|</span></span></code></pre></td></tr></tbody></table></div></div><p>If we label each bit starting from <strong>Bit 3</strong> on the left to <strong>Bit 0</strong> on the right, we can see a pattern. Bit 0
alternates off and on with every number. Bit 1 alternates at 1/2 the rate of Bit 1. Bit 2 alternates at 1/4 the rate of
Bit 1. And Bit 3 alternates at 1/8 the rate of Bit 1.</p><p>With our <strong>base-10</strong> system, numbers count up from 0 to 9 and then shift over to the left when we grow larger than what 9
can represent. 9 becomes 10. 19 becomes 20. 29 becomes 30. And so on.</p><p>Binary is no different, only it’s base-2, so we only have 0 and 1. We go from 0b0001 to 0b0010. 0b0011 to 0b0100. 0b0111 to
0b1000.</p><p>In base-10, we can get any digit with a sum. Remember talking about the “ones place”, the “tens place”, the “hundreds place”,
etc? The base-10 number 216 has a 2 in the hundreds place, a 1 in the tens place, and a 6 in the hundreds place. 206 can
then be created by multiplying each digit by its place and summing them all:
<span class="jsonly"><span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>2</mn><mo>⋅</mo><mn>1</mn><msup><mn>0</mn><mn>2</mn></msup><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>⋅</mo><mn>1</mn><msup><mn>0</mn><mn>1</mn></msup><mo>)</mo><mo>+</mo><mo>(</mo><mn>6</mn><mo>⋅</mo><mn>1</mn><msup><mn>0</mn><mn>0</mn></msup><mo>)</mo><mo>=</mo><mn>2</mn><mn>1</mn><mn>6</mn></mrow><annotation encoding="application/x-tex">(2 \cdot 10^2) + (1 \cdot 10^1) + (6 \cdot 10^0) = 216</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.814108em;"></span><span class="strut bottom" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">2</span><span class="mbin">⋅</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">⋅</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathrm">6</span><span class="mbin">⋅</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">1</span><span class="mord mathrm">6</span></span></span></span></span></span><noscript><img style=display:inline;vertical-align:middle;background:#fff src=https://latex.codecogs.com/gif.latex?\inline&space;%282%20%5ccdot%2010%5e2%29%20%2b%20%281%20%5ccdot%2010%5e1%29%20%2b%20%286%20%5ccdot%2010%5e0%29%20%3d%20216 title="(2 \cdot 10^2) &#43; (1 \cdot 10^1) &#43; (6 \cdot 10^0) = 216"></noscript></p><p>Again, binary is no different, only you have a ones place, a twos place, a fours place, etc. The binary number 0b101
has a 1 in the fours place, a 0 in the twos place, and a 1 in the ones place:
<span class="jsonly"><span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>1</mn><mo>⋅</mo><msup><mn>2</mn><mn>2</mn></msup><mo>)</mo><mo>+</mo><mo>(</mo><mn>0</mn><mo>⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>⋅</mo><msup><mn>2</mn><mn>0</mn></msup><mo>)</mo><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">(1 \cdot 2^2) + (0 \cdot 2^1) + (1 \cdot 2^0) = 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.814108em;"></span><span class="strut bottom" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">⋅</span><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathrm">0</span><span class="mbin">⋅</span><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">⋅</span><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathrm">5</span></span></span></span></span></span><noscript><img style=display:inline;vertical-align:middle;background:#fff src=https://latex.codecogs.com/gif.latex?\inline&space;%281%20%5ccdot%202%5e2%29%20%2b%20%280%20%5ccdot%202%5e1%29%20%2b%20%281%20%5ccdot%202%5e0%29%20%3d%205 title="(1 \cdot 2^2) &#43; (0 \cdot 2^1) &#43; (1 \cdot 2^0) = 5"></noscript></p><p>Bit 3 is called the <strong>Most Significant Bit (MSB)</strong> because it contributes the most to the final value of the number (because
its the eights place). Bit 0 is called the <strong>Least Significant Bit (LSB)</strong> because it contributes the least to the final
value (because it’s the ones place).</p><h3 id="hexadecimal">Hexadecimal</h3><p>Reading binary becomes difficult for a human after about four bits though, so we often use <strong>hexadecimal (hex)</strong> which
is <strong>base-16</strong>. While base-2 has 0 and 1, and base-10 has 0 through 9, base-16 has 0 through 9 and A through F. The
principles of counting it are the same as base-2 and base-10, there are just now letters involved.</p><ul><li>A = 10</li><li>B = 11</li><li>C = 12</li><li>D = 13</li><li>E = 14</li><li>F = 15.</li></ul><p>The hex number 0xBEEF is <span class="jsonly"><span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>B</mi><mo>⋅</mo><mn>1</mn><msup><mn>6</mn><mn>3</mn></msup><mo>)</mo><mo>+</mo><mo>(</mo><mi>E</mi><mo>⋅</mo><mn>1</mn><msup><mn>6</mn><mn>2</mn></msup><mo>)</mo><mo>+</mo><mo>(</mo><mi>E</mi><mo>⋅</mo><mn>1</mn><msup><mn>6</mn><mn>1</mn></msup><mo>)</mo><mo>+</mo><mo>(</mo><mi>F</mi><mo>⋅</mo><mn>1</mn><msup><mn>6</mn><mn>0</mn></msup><mo>)</mo><mo>=</mo><mn>4</mn><mn>8</mn><mn>8</mn><mn>7</mn><mn>9</mn></mrow><annotation encoding="application/x-tex">(B \cdot 16^3) + (E \cdot 16^2) + (E \cdot 16^1) + (F \cdot 16^0) = 48879</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.814108em;"></span><span class="strut bottom" style="height: 1.06411em; vertical-align: -0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span style="margin-right: 0.05017em;" class="mord mathit">B</span><span class="mbin">⋅</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">6</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span style="margin-right: 0.05764em;" class="mord mathit">E</span><span class="mbin">⋅</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">6</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span style="margin-right: 0.05764em;" class="mord mathit">E</span><span class="mbin">⋅</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">6</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span style="margin-right: 0.13889em;" class="mord mathit">F</span><span class="mbin">⋅</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">6</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathrm">4</span><span class="mord mathrm">8</span><span class="mord mathrm">8</span><span class="mord mathrm">7</span><span class="mord mathrm">9</span></span></span></span></span></span><noscript><img style=display:inline;vertical-align:middle;background:#fff src=https://latex.codecogs.com/gif.latex?\inline&space;%28B%20%5ccdot%2016%5e3%29%20%2b%20%28E%20%5ccdot%2016%5e2%29%20%2b%20%28E%20%5ccdot%2016%5e1%29%20%2b%20%28F%20%5ccdot%2016%5e0%29%20%3d%2048879 title="(B \cdot 16^3) &#43; (E \cdot 16^2) &#43; (E \cdot 16^1) &#43; (F \cdot 16^0) = 48879"></noscript></p><p>In binary that would be 0b1011111011101111, which is much less pleasant to the human experience.</p><h3 id="bits-and-bytes">Bits and Bytes</h3><p>A single binary digit is called a <strong>bit</strong>. Because it’s binary, it can either be <strong>ON (1)</strong> or <strong>OFF (0)</strong>.</p><p>Eight bits make a <strong>byte</strong>, so a byte can go as high as <span class="jsonly"><span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>=</mo><mn>2</mn><mn>5</mn><mn>5</mn></mrow><annotation encoding="application/x-tex">2^8 = 255</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.814108em;"></span><span class="strut bottom" style="height: 0.814108em; vertical-align: 0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span class="" style="top: -0.363em; margin-right: 0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">8</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span class="" style="font-size: 0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mord mathrm">5</span></span></span></span></span></span><noscript><img style=display:inline;vertical-align:middle;background:#fff src=https://latex.codecogs.com/gif.latex?\inline&space;2%5e8%20%3d%20255 title="2^8 = 255"></noscript>. In hex that is 0xFF.</p><p>The common multiples you will see are 1 byte (0xFF), 2 bytes (0xFFFF), 4 bytes (0xFFFFFFFF), and 8 bytes
(0xFFFFFFFFFFFFFFFF).</p><h3 id="and-or-not-xor">AND, OR, NOT, XOR</h3><p>Beyond understanding how to read binary and hex, you need to know how to manipulate them with some common operations:
<strong>AND</strong>, <strong>OR</strong>, and <strong>XOR</strong>.</p><p>They are explained most concisely in table form:</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">| AND |    |  OR |    | NOT |    | XOR |
</span></span><span class="line"><span class="cl">-------    -------    -------    -------
</span></span><span class="line"><span class="cl">|0|0|0|    |0|0|0|    |0|1|      |0|0|0|
</span></span><span class="line"><span class="cl">|0|1|0|    |0|1|1|    |1|0|      |0|1|1|
</span></span><span class="line"><span class="cl">|1|0|0|    |1|0|1|               |1|0|1|
</span></span><span class="line"><span class="cl">|1|1|1|    |1|1|1|               |1|1|0|</span></span></code></pre></td></tr></tbody></table></div></div><p>AND is true if both bits are true. OR is true if either bit is true. NOT toggles the bit. XOR is true if only
a single bit is true.</p><p>In C++, AND is using the symbol <strong>&amp;</strong>, OR uses the symbol <strong>|</strong>, NOT uses the symbol <strong>~</strong>, and XOR uses the symbol <strong>^</strong>.</p><h3 id="bitmasking">Bitmasking</h3><p>AND and OR are especially useful for <strong>bitmasking</strong>, where you can manipulate a binary number with another binary number.</p><p>AND is good for <strong>clearing bits</strong>.</p><p>Let’s say we have the binary number 0b0110 and we want to clear Bit 1. We can AND it with 0b1101. The 0 will clear the
bit if it’s set (1 AND 0 = 0), but any set bits will stay set (1 AND 1 = 1).</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">   0b0110
</span></span><span class="line"><span class="cl">AND
</span></span><span class="line"><span class="cl">   0b1101---------
</span></span><span class="line"><span class="cl">   0b0100</span></span></code></pre></td></tr></tbody></table></div></div><p>OR is good for <strong>setting bits</strong>.</p><p>Let’s say we have the binary number 0b0110 and we want to set Bit 3. We can OR it with 0b1000. The 1 will set the bit
if it’s not set (1 OR 0 = 1), but any unset bits will stay unset (0 OR 1 = 0).</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">   0b0110
</span></span><span class="line"><span class="cl">OR
</span></span><span class="line"><span class="cl">   0b1000
</span></span><span class="line"><span class="cl">---------
</span></span><span class="line"><span class="cl">   0b1110</span></span></code></pre></td></tr></tbody></table></div></div><p>NOT is good for <strong>toggling bits</strong>.</p><p>Let’s say we have the binary number 0b0110 and we want to toggle the off bits on and the on bits off. We can use the
NOT operation.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">NOT
</span></span><span class="line"><span class="cl">   0b0110
</span></span><span class="line"><span class="cl">---------
</span></span><span class="line"><span class="cl">   0b1001</span></span></code></pre></td></tr></tbody></table></div></div><p>XOR is good for many things, but one common application in CPUs is to clear a register by XORing it with itself.</p><p>Let’s say we have the binary number 0b0110 and we want to clear it all to zeros without using any other numbers. We
can use XOR.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">   0b0110
</span></span><span class="line"><span class="cl">XOR
</span></span><span class="line"><span class="cl">   0b0110
</span></span><span class="line"><span class="cl">---------
</span></span><span class="line"><span class="cl">   0b0000</span></span></code></pre></td></tr></tbody></table></div></div><h3 id="bit-shifting">Bit Shifting</h3><p><strong>Bit shifting</strong> is the act of moving the bits of a number left or right. A left shift is equivalent to multiplying by 2
and a right shift is equivalent to dividing by 2.</p><div class="highlight"><div class="chroma"><table class="lntable"><tbody><tr><td class="lntd"><pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td><td class="lntd"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">0b100 (4) -&gt; 0b010 (2) -&gt; 0b001 (1)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0b001 (1) &lt;- 0b010 (2) &lt;- 0b100 (4)</span></span></code></pre></td></tr></tbody></table></div></div><h2 id="source-code">Source Code</h2><hr><p>You can find all of the code <a href="https://code.austinmorlan.com/austin/2019-chip8-emulator">here</a>.</p><br><br>Last Edited: Dec 20, 2022<br><br><br><br></div></main><script>renderMathInElement(document.body);</script></body></html>